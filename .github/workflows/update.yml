name: Update weekly
on:
  schedule:
    - cron: 0 0 * * *
    #- cron: 0 13 * * 1

jobs:
  deploy:
    name: "Update"
    runs-on: "ubuntu-latest"
    
    steps:
      - name: "Checkout"
        uses: actions/checkout@v1
      - name: Setup Python Version
        uses: actions/setup-python@v2
        with:
          python-version: 3.8
      - name: Install Python dependencies
        run: python -m pip install beautifulsoup4 natsort
      - name: Build
        env:
          MTE90_TOKEN: ${{ secrets.MTE90_TOKEN }}
        run: |-
          ./scraper.py && ./index.py
    - name: Commit and push if DB changed
      run: |-
        git diff
        git config --global user.email "catalog-bot@example.com"
        git config --global user.name "catalog-bot"
        git diff --quiet || (git add ./*.json ./index.html && git commit -m "Updated DB")
        git push
